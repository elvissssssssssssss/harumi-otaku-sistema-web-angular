<div class="dashboard-container">

  <!-- Loading global (datos) -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Error -->
  <div *ngIf="!loading && error" class="alert alert-danger d-flex justify-content-between align-items-center">
    <span>{{ error }}</span>
   
  </div>

  <!-- Contenido Dashboard -->
  <div *ngIf="!loading && !error">

    <!-- Sección de Cards de Resumen -->
    <div class="row g-4 mb-4">
      <div class="col-xl-3 col-md-6" *ngFor="let card of summaryCards">
        <div class="card summary-card bg-{{card.color}}-gradient shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-1">{{ card.value }}</h2>
                <p class="mb-0 fw-medium text-muted">{{ card.label }}</p>
              </div>
              <div class="icon-shape rounded-circle bg-white text-{{card.color}}">
                <i class="fas {{card.icon}}"></i>
              </div>
            </div>

            <div class="mt-3" *ngIf="card.change">
              <span class="badge bg-{{card.change.color}}">
                <i class="fas {{card.change.icon}} me-1"></i>
                {{card.change.value}}
              </span>
              <span class="text-muted small ms-2">vs última semana</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico Principal -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-chart-line text-primary me-2"></i>
              Rendimiento de Ventas
            </h5>

            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                Últimos 7 días
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" (click)="$event.preventDefault()">Últimos 7 días</a></li>
                <li><a class="dropdown-item" href="#" (click)="$event.preventDefault()">Últimos 30 días</a></li>
                <li><a class="dropdown-item" href="#" (click)="$event.preventDefault()">Este mes</a></li>
              </ul>
            </div>
          </div>

          <!-- IMPORTANTE: contenedor dedicado con height -->
          <div class="card-body pt-0 chart-wrapper chart-lg">
            <div class="chart-spinner" *ngIf="chartsLoading">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
            <canvas id="salesChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección Inferior con más gráficos -->
    <div class="row">
      <!-- Gráfico de Barras -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-chart-bar text-success me-2"></i>
              Productos más vendidos
            </h5>
          </div>

          <div class="card-body chart-wrapper chart-sm">
            <div class="chart-spinner" *ngIf="chartsLoading">
              <div class="spinner-border text-success" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
            <canvas id="topProductsChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Gráfico Circular -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-chart-pie text-warning me-2"></i>
              Distribución por categoría
            </h5>
          </div>

          <div class="card-body chart-wrapper chart-sm">
            <div class="chart-spinner" *ngIf="chartsLoading">
              <div class="spinner-border text-warning" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
            <canvas id="categoriesChart"></canvas>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
